#!/usr/bin/env python
#filetype: py

import os
import sys
import scripts.databases as databases

shell.prefix("unset pipefail; ")
configfile: "../config/config.yaml"
merge_config = 1


# Gene Ontology
include: "rules/go.smk"
# Human Phenotype Ontology
include: "rules/hpo.smk"
# Mondo  
include: "rules/mondo.smk"
# Ensembl Genes (or NCBI??) 
include: "rules/ensembl.smk"
#Uniprot
include: "rules/uniprot.smk"
# RNACentral ncRNAs
include: "rules/rnacentral.smk"
# RO
include: "rules/ro.smk"
#GOA
include: "rules/goa.smk"
#HPOA
include: "rules/hpoa.smk"
# Disgenet
include: "rules/disgenet.smk"
#Uberon
include: "rules/uberon.smk"
#Cell Ontology
include: "rules/cl.smk"
#Bgee
include: "rules/bgee.smk"
#Mirtarbase
include: "rules/mirtarbase.smk"
#NPInter
include: "rules/npinter.smk"
#String
include: "rules/stringdb.smk"


rule all:
    input: "../data/processed/finals/merged_nodes.tsv", "../data/processed/finals/merged_nodes.tsv", "../data/processed/db_versions.yaml"

rule gather_data:
    input: databases.get_input_files()
    output: "../data/processed/finals/merged_nodes.tsv", "../data/processed/finals/merged_edges.tsv"
    shell: "kgx merge --merge-config ../config/merge_config.yaml"


rule get_db_versions:
    input: disgenet = "../data/raw/disgenet_readme.txt"
            ,go = "../data/raw/go_release-date.json"
            ,goa ="../data/raw/goa_release-date.json"
            ,rnacentral ="../data/raw/rnacentral_release_notes.txt"
            ,uniprot ="../data/raw/uniprot_release.metalink"
            ,hpoa = "../data/raw/hpoa.hpoa"
            ,ensembl = "../data/raw/Homo_sapiens.GRCh38.108.uniprot.tsv.gz"
            ,mirtarbase = "../data/raw/9.0_hsa_MTI.xlsx"
            ,npinter = "../data/raw/interaction_NPInterv5.txt.gz"
            ,string = "../data/raw/9606.protein.links.v11.5.txt.gz"
            ,bgee= "../data/raw/bgee_v15_0_Homo_sapiens_expr_simple.tsv.gz"
    output: "../data/processed/db_versions.yaml"
    shell: "python scripts/get_db_versions.py -u {input.uniprot} -m {input.mirtarbase} -n {input.npinter} -b {input.bgee} -s {input.string} -d {input.disgenet} -g {input.go} -a {input.goa} -e {input.ensembl} -r {input.rnacentral} -hp {input.hpoa} -o {output}"

#!/usr/bin/env python
#filetype: py

import os
import sys

shell.prefix("unset pipefail; ")
configfile: "../config/config.yaml"
merge_config = 1


# Gene Ontology
include: "rules/go.smk"
# Human Phenotype Ontology
include: "rules/hpo.smk"
# Mondo  
include: "rules/mondo.smk"
# Ensembl Genes (or NCBI??) 
include: "rules/ensembl.smk"
#Uniprot
include: "rules/uniprot.smk"
# RNACentral ncRNAs
include: "rules/rnacentral.smk"
# RO
include: "rules/ro.smk"
#GOA
include: "rules/goa.smk"
#HPOA
include: "rules/hpoa.smk"
# Disgenet
include: "rules/disgenet.smk"
#Uberon
include: "rules/uberon.smk"
#Cell Ontology
include: "rules/cl.smk"
#Bgee
include: "rules/bgee.smk"


rule all:
    input: "../data/processed/merged_nodes.tsv", "../data/processed/merged_nodes.tsv"

rule gather_data:
    input: "../data/processed/go_nodes.tsv", "../data/processed/go_edges.tsv"
           ,"../data/processed/hpo_nodes.tsv", "../data/processed/hpo_edges.tsv"
           ,"../data/processed/mondo_nodes.tsv", "../data/processed/mondo_edges.tsv"
           ,"../data/processed/ensembl_nodes.tsv", "../data/processed/ensembl_edges.tsv"
           ,"../data/processed/goa_nodes.tsv", "../data/processed/goa_edges.tsv"
           ,"../data/processed/hpoa_nodes.tsv", "../data/processed/hpoa_edges.tsv"
           ,"../data/processed/disgenet_nodes.tsv", "../data/processed/disgenet_edges.tsv"
           ,"../data/processed/uberon_nodes.tsv", "../data/processed/uberon_edges.tsv"
#           , "../data/processed/bgee_nodes.tsv", "../data/processed/bgee_edges.tsv"
           , "../data/processed/cl_nodes.tsv", "../data/processed/cl_edges.tsv"
    output: "../data/processed/merged_nodes.tsv", "../data/processed/merged_edges.tsv"
#    shell: "kgx merge --merge-config ../config/merge_config.yaml -p 2"
    shell: "kgx merge --merge-config ../config/merge_config.yaml"


rule get_db_versions:
    input: disgenet = "../data/raw/disgenet_readme.txt"
            ,go = "../data/raw/go_release-date.json"
            ,goa ="../data/raw/goa_release-date.json"
            ,rnacentral ="../data/raw/rnacentral_release_notes.txt"
            ,uniprot ="../data/raw/uniprot_release.metalink"
            ,hpoa = "../data/raw/hpoa.hpoa"
    output: "../data/processed/db_versions.yaml"
    shell: "python scripts/get_db_versions.py -u {input.uniprot} -d {input.disgenet} -g {input.go} -a {input.goa} -r {input.rnacentral} -hp {input.hpoa} -o {output}"